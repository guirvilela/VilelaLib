import { Meta } from '@storybook/addon-docs';

<Meta title="Guide/Testing/Funcoes" />

> [Voltar ao sum√°rio](/?path=/docs/guide-testing-summary--page)

# Testar fun√ß√µes com Jest

### Vamos testar o fechamento de um modal ao clicar em cancelar

```typescript
export interface MyComponentForm {
  modal: boolean;
}

export function Component() {
  const form = useForm<MyComponentForm>({
    modal: false
  });

  return (
    <HubModal
      opened={form.value.modal}
      data-testid="my-component-testid"
      header={t('my-component_modal-header')}
      width={file ? '70vw' : '40vw'}
      contentHeight="92vh"
      onClose={() => form.setAll({ modal: false })}
      actions={
        <HubGrid row cols={['4', '4', '4']}>
          <div />
          <HubButton
            full
            variant="ghost"
            onClick={() => form.setAll({ modal: false })}
          >
            {t('reuse_cancel')}
          </HubButton>
        </HubGrid>
      }
    />
  );
}
```

```typescript
it('Should be able close modal when click on cancel button', () => {
  const closeModalBtnMock = jest.fn();

  const { getByText } = renderComponent({
    form: useFormMock<MyComponentForm>({
      value: {
        modal: true
      },
      spySetAll: closeModalBtnMock
    })
  });

  const modalCloseBtn = getByText('reuse_cancel');

  fireEvent.click(modalCloseBtn);

  expect(closeModalBtnMock).toHaveBeenCalledWith({ modal: false });
});
```

## Explica√ß√£o

- prmeiro criamos uma variavel que vai ser a fun√ß√£o que vamos chamar e observar se ela foi chamada no expect()

```typescript
const closeModalBtnMock = jest.fn();`
```

- Setamos as variaveis necess√°rias para o modal abrir
- Passamos a fun√ß√£o que ser√° chamada no componente dentro da fun√ß√£o, no caso formModalStatus.setAll(), ent√£o colocamos spySetAll: closeModalBtnMock, para observarmos se closeModalBtnMock vai ser chamada

```typescript
const { getByText } = renderComponent({
  formModalStatus: useFormMock<MyComponentStatus>({
    value: {
      modal: true
    },
    spySetAll: closeModalBtnMock
  })
});
```

- Pegamos atrav√©s do texto do bot√£o, o elemento de bot√£o que ser√° clicado e ao clicar, executar a fun√ß√£o

```typescript
const modalCloseBtn = getByText('reuse_cancel');
```

- Usamos a fun√ß√£o fireEvent.click(), para executar um clique no bot√£o, passando por par√¢metro, o bot√£o que queremos clicar

```typescript
fireEvent.click(modalCloseBtn);
```

- Por Final esperamos que a fun√ß√£o closeModalBtnMock, seja chamada pelo clique do bot√£o e esperamos que tenha chamado com modal: false do jeito que o index.tsx necessita

```typescript
expect(closeModalBtnMock).toHaveBeenCalledWith({ modal: false });
```

> Pr√≥ximo passo... [Inputs ‚úçüèª](/?path=/docs/guide-testing-inputs--page)

---

Keep calm and code on ü§ò.
