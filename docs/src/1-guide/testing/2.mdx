import { Meta } from '@storybook/addon-docs';

<Meta title="Guide/Testing/Estrutura" />

> [Voltar ao sum√°rio](/?path=/docs/guide-testing-summary--page)

# Estrutura dos testes

Utilizamos essa se√ß√£o para compartilhar conhecimento sobre desenvolvimento de testes.

## Estrutura inicial do teste

![testid structure](/assets/img/tests-guide/guide-testing-folders-structure.png)

no arquivo index.test.tsx, cole o c√≥digo abaixo e siga as instru√ß√µes.

- Substitua onde est√° _YourComponent_ para seu componente

- Selecione YourComponent, aperte CTRL + D at√© todos textos tiverem selecionados e cole o nome do componente

- Ajuste a tipagem que estar√° dando erro provavelmente em YourComponentProps. S√£o as tipagens do seu componente que esta no index.tsx

```typescript
import { useActionMock } from '@hubert/http';
import { I18nProvider } from '@hubert/i18n';
import { wrapse } from '@hubert/shared';
import { ThemeProvider } from '@hubert/styles';
import { render } from '@testing-library/react';
import { YourComponent } from '.';

type YourComponentProps = React.YourComponentProps<typeof YourComponent>;

describe('YourComponent component test', () => {
  const defaultProps: YourComponentProps = {};

  const renderComponent = (props?: Partial<YourComponentProps>) => {
    return render(<YourComponent {...defaultProps} {...props} />, {
      wrapper: wrapse(ThemeProvider, I18nProvider)
    });
  };

  it('matches snapshot', () => {
    const { asFragment } = renderComponent();
    expect(asFragment()).toMatchSnapshot();
  });
});
```

## Explica√ß√£o da estrutura inicial de teste

### YourComponentProps

Define o tipo das propriedades do componente YourComponent baseado em seu tipo existente, garantindo que os testes estejam alinhados com a tipagem real.

```typescript
type YourComponentProps = React.YourComponentProps<typeof YourComponent>;
```

O describe agrupa testes relacionados para o componente YourComponent. Ele serve como um t√≠tulo para identificar esse grupo nos relat√≥rios de teste.

```typescript
describe('YourComponent component test', () => {...})
```

### defaultProps

Define as propriedades padr√£o usadas para renderizar o componente nos testes. Aqui est√° vazio ({}), mas voc√™ pode adicionar valores padr√£o se necess√°rio.

```typescript
const defaultProps: YourComponentProps = {};
```

### Fun√ß√£o de renderiza√ß√£o auxiliar

**renderComponent**: Fun√ß√£o que encapsula a renderiza√ß√£o do componente para reutiliza√ß√£o nos testes. Aceita propriedades parciais para substituir os valores padr√£o.

**render**: Renderiza o componente usando os defaultProps e qualquer substitui√ß√£o passada.

**wrapper**: Usa a fun√ß√£o wrapse para combinar os provedores ThemeProvider e I18nProvider, criando o contexto necess√°rio para que o componente funcione corretamente.

```typescript
const renderComponent = (props?: Partial<YourComponentProps>) => {
  return render(<YourComponent {...defaultProps} {...props} />, {
    wrapper: wrapse(ThemeProvider, I18nProvider)
  });
};
```

## Teste de Snapshot

```typescript
it('matches snapshot', () => {
  const { asFragment } = renderComponent();
  expect(asFragment()).toMatchSnapshot();
});
```

- it: Define um caso de teste individual. Aqui, o teste verifica se o componente corresponde ao snapshot.

- renderComponent: Renderiza o componente com a fun√ß√£o auxiliar definida acima.

- asFragment: Retorna o DOM do componente como um fragmento.

- toMatchSnapshot: Compara o fragmento gerado com um snapshot salvo anteriormente. Se o DOM mudou, o teste falhar√°.

## Tipagens Especiais

Usamos a tipagem do componente dentro da const defaultProps.

```typescript
import { useActionMock } from '@hubert/http';
import { useFormMock, wrapse } from '@hubert/shared';

type YourComponentProps = React.YourComponentProps<typeof YourComponent>;

const defaultProps: YourComponentProps = {
  action: useActionMock(),
  getAction: useActionMock(),
  form: useFormMock<PostFunctionRequest>(),
  formModal: useFormMock<FormModalStatus>(),
  onFunction: jest.fn(),
  onDeleteFile: jest.fn()
};
```

### useActionMock()

Tipagem para respostas de chamadas a API

- Mocka a√ß√µes HTTP ou l√≥gicas externas do componente, substituindo as fun√ß√µes reais por implementa√ß√µes simuladas.

#### Setando valores da actionMock()

Ao setar os valores da Action, vai ser considerado nos testes os valores vindo do teste e n√£o relacionado a nada da API.

```typescript
import { useActionMock } from '@hubert/http';

type YourComponentProps = React.YourComponentProps<typeof YourComponent>;

const defaultProps: YourComponentProps = {
  action: useActionMock({
    payload: {
      condominio: 991,
      unidade: 43659
    },
    loading: false
  })
};
```

### useFormMock()

Mocka os formul√°rios usados pelo componente.

(index.tsx)

```typescript
export interface YourComponentProps {
  onFunction: () => void;
}

export interface MyComponentForm {
   condominio: number,
   unidade: number
}

export function YourComponent({onFunction}: YourComponent) {

const form = useForm<MyComponentForm>({
  condominio: 0
  unidade: 0
})

return (
  <HubButton onClick={onFunction}>Continuar</HubButton>
)}
```

```typescript
import { useFormMock } from '@hubert/shared';

type YourComponentProps = React.YourComponentProps<typeof YourComponent>;

const defaultProps: YourComponentProps = {
  form: useFormMock<MyComponentForm>({
    value: {
      condominio: 991,
      unidade: 43659
    }
  })
};
```

### Tipagem de Fun√ß√µes() {}

Usamos jest.fn(), para falar pro Jest que aquela prop √© uma fun√ß√£o que poder√° ser chamada futuramente para testes

```typescript
type YourComponentProps = React.YourComponentProps<typeof YourComponent>;

const defaultProps: YourComponentProps = {
  onFunction: jest.fn()
};
```

> Pr√≥ximo passo... [Primeiro teste ‚úçüèª](/?path=/docs/guide-testing-primeiro-teste--page)

---

Keep calm and code on ü§ò.
